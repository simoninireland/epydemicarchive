{% extends 'base.tmpl' %}

{% block scripts %}
  {{ super() }}
  <script>
    function copyTextToClipboard(id) {
      var copyText = document.getElementById(id);
      copyText.select();
      navigator.clipboard.writeText(copyText.value);
    }
  </script>
{% endblock %}

{% block app_content %}
  <h1>User profile for {{ profile.user.email }}</h1>

  {% with is_owner = (current_user.email == profile.user.email) %}
    <form action="" method="post" novalidate>
      {{ form.hidden_tag() }}
      <p>
	{{ form.name.label }}
	<div class="input-group">
	  <span class="input-group-addon" id="basic-addon1">
	    <span class="glyphicon glyphicon-user" aria-hidden="true"></span>
	  </span>
	  {% if is_owner %}
	    {{ form.name(size=64) }}
	  {% else %}
	    {{ form.name(size=64, readonly="readonly") }}
	  {% endif %}
	</div>
      </p>
      <p>
	{{ form.affiliation.label }}
	<div class="input-group">
	  <span class="input-group-addon" id="basic-addon1">
	    <span class="glyphicon glyphicon-home" aria-hidden="true"></span>
	  </span>
	  {% if is_owner %}
	    {{ form.affiliation(size=64) }}
	  {% else %}
	    {{ form.affiliation(size=64, readonly="readonly") }}
	  {% endif %}
	</div>
    </p>
      <p>
	{{ form.url.label }}
	<div class="input-group">
	  <span class="input-group-addon" id="basic-addon1">
	    <span class="glyphicon glyphicon-link" aria-hidden="true"></span>
	  </span>
	  {% if is_owner %}
	    {{ form.url(size=32) }}
	  {% else %}
	    {{ form.url(size=32, readonly="readonly") }}
	    {% endif %}
	</div>
      </p>
      <p>
	{{ form.bio.label }}
	<div class="input-group">
	  <span class="input-group-addon" id="basic-addon1">
	    <span class="glyphicon glyphicon-pencil" aria-hidden="true"></span>
	  </span>
	  {% if is_owner %}
	    {{ form.bio(rows="8", cols="48") }}
	  {% else %}
	    {{ form.bio(rows="8", cols="48", readonly="readonly") }}
	  {% endif %}
	</div>
      </p>
      {% if is_owner %}
	<p>
	  <label for="api_key">API key</label>
	  <div class="input-group">
	    <span class="input-group-addon">
	      <span class="glyphicon glyphicon-wrench" aria-hidden="true"></span>
	    </span>
	    <input type="text" id="api_key_token"
		   value="{{ user.api_key }}" size="32"
		   readonly="readonly">
	    (expires {{ user.api_key_expires.isoformat(timespec='seconds') + 'Z' }}).
	    <button type="button" onclick="copyTextToClipboard('api_key_token')">
	      Copy to clipboard
	    </button>
	    &nbsp;
	    {{ form.api_key() }}
	  </div>
	</p>
      {% endif %}
      <p>
	{% if is_owner %}
	  {{ form.submit() }}
	{% endif %}
	&nbsp; {{ form.cancel() }}
      </p>
    </form>
  {% endwith %}
{% endblock %}
